<!--
Author: Jason Ko
Mail: phelpske.dev at gmail dot com
Last updated: July 30, 2025 00:12 AM
-->

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ©Ÿè»Šè»Šä½æŠ½ç±¤ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, sans-serif; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col lg:flex-row items-start p-6 gap-6">

  <!-- å·¦å´ï¼šæ“ä½œå€ -->
  <div class="flex-1 w-full max-w-2xl">
    <h1 class="text-3xl font-bold mb-4">ğŸï¸ æ©Ÿè»Šè»Šä½æŠ½ç±¤ç³»çµ±</h1>

    <div class="flex gap-4 mb-4">
      <button id="drawHouseholdBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        ç¬¬ä¸€éšæ®µï¼šæŠ½å‡ºä½æˆ¶
      </button>
      <button id="drawParkingBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
        ç¬¬äºŒéšæ®µï¼šåˆ†é…è»Šä½
      </button>
      <button id="resetAllBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">
        ğŸ”„ æ¸…é™¤æ­·å²
      </button>
    </div>

    <div class="text-sm text-gray-700 mb-4">
      å‰©é¤˜ä½æˆ¶æ•¸ï¼š<span id="remainingHouseholds">198</span>ï¼Œ
      å‰©é¤˜è»Šä½æ•¸ï¼š<span id="remainingParking">202</span>
    </div>

    <div class="bg-white rounded shadow p-4 mb-4">
      <h2 class="text-xl font-semibold mb-2">ğŸ¯ ç•¶å‰ä½æˆ¶</h2>
      <div id="householdResult" class="text-blue-700 font-mono text-lg"></div>
    </div>

    <div class="bg-white rounded shadow p-4">
      <h2 class="text-xl font-semibold mb-2">ğŸ…¿ï¸ ç•¶å‰è»Šä½é…å°</h2>
      <div id="parkingResult" class="text-green-700 font-mono text-lg"></div>
    </div>
  </div>

  <!-- å³å´ï¼šç´€éŒ„å´æ¬„ -->
  <aside class="w-full lg:w-80 shrink-0">
    <div class="bg-white rounded shadow p-4 mb-4 h-[300px] overflow-y-auto">
      <h3 class="text-lg font-semibold mb-2">ğŸ“‹ ä½æˆ¶æŠ½ç±¤ç´€éŒ„</h3>
      <ul id="householdHistory" class="list-decimal list-inside text-sm text-gray-800 space-y-1"></ul>
    </div>

    <div class="bg-white rounded shadow p-4 h-[300px] overflow-y-auto">
      <h3 class="text-lg font-semibold mb-2">ğŸ“‹ è»Šä½é…å°ç´€éŒ„</h3>
      <ul id="parkingHistory" class="list-disc list-inside text-sm text-gray-800 space-y-1"></ul>
    </div>
  </aside>

  <script>
    const floors = Array.from({ length: 22 }, (_, i) => i + 2);
    const units = ['A1','A2','A3','A5','A6','A7','A8','A9','A11'];
    const allHouseholds = [];
    floors.forEach(f => units.forEach(u => allHouseholds.push(`${u}-${f}F`)));

    let householdPool = [...allHouseholds];
    let parkingPool = Array.from({ length: 202 }, (_, i) => i + 1);
    let drawnHouseholds = [];
    let lastDrawnHousehold = null;
    let awaitingParking = false;

    const householdResult = document.getElementById("householdResult");
    const parkingResult = document.getElementById("parkingResult");
    const householdHistory = document.getElementById("householdHistory");
    const parkingHistory = document.getElementById("parkingHistory");
    const remainingHouseholds = document.getElementById("remainingHouseholds");
    const remainingParking = document.getElementById("remainingParking");

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function updateCounters() {
      remainingHouseholds.textContent = householdPool.length;
      remainingParking.textContent = parkingPool.length;
    }

    function drawHousehold() {
      if (awaitingParking) {
        alert("è«‹å…ˆåˆ†é…ç›®å‰ä½æˆ¶çš„è»Šä½å¾Œæ‰èƒ½å†æŠ½ä¸‹ä¸€æˆ¶ã€‚ğŸ‘€");
        return;
      }
      if (householdPool.length === 0) {
        alert("å·²æŠ½å®Œæ‰€æœ‰ä½æˆ¶ï¼");
        return;
      }
      shuffle(householdPool);
      const household = householdPool.pop();
      lastDrawnHousehold = household;
      awaitingParking = true;

      householdResult.textContent = `${drawnHouseholds.length + 1}. ${household}`;
      const li = document.createElement("li");
      li.textContent = `${household}`;
      householdHistory.appendChild(li);
    }

    function drawParking() {
      if (!lastDrawnHousehold) {
        alert("è«‹å…ˆæŠ½ä½æˆ¶å†é…å°è»Šä½ï¼");
        return;
      }
      if (parkingPool.length === 0) {
        alert("è»Šä½å·²ç”¨å®Œï¼");
        return;
      }
      shuffle(parkingPool);
      const parking = parkingPool.pop();
      const resultText = `${lastDrawnHousehold} âœ è»Šä½ ${parking}`;
      parkingResult.textContent = resultText;

      const li = document.createElement("li");
      li.textContent = resultText;
      parkingHistory.appendChild(li);

      drawnHouseholds.push(lastDrawnHousehold);
      lastDrawnHousehold = null;
      awaitingParking = false;
      updateCounters();
    }

    function resetAll() {
      if (!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æŠ½ç±¤ç´€éŒ„ä¸¦é‡æ–°é–‹å§‹å—ï¼Ÿ")) return;

      householdPool = [...allHouseholds];
      parkingPool = Array.from({ length: 202 }, (_, i) => i + 1);
      drawnHouseholds = [];
      lastDrawnHousehold = null;
      awaitingParking = false;

      householdResult.textContent = "";
      parkingResult.textContent = "";
      householdHistory.innerHTML = "";
      parkingHistory.innerHTML = "";
      updateCounters();
    }

    document.getElementById("drawHouseholdBtn").addEventListener("click", drawHousehold);
    document.getElementById("drawParkingBtn").addEventListener("click", drawParking);
    document.getElementById("resetAllBtn").addEventListener("click", resetAll);

    updateCounters();
  </script>
</body>
</html>
